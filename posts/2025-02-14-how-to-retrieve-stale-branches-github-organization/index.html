<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>ðŸš€ How to Retrieve Stale Branches Across All Repositories in a GitHub Organization | </title><link href=/psychic-octo-potato/img/favicon.png rel=icon><link href=/psychic-octo-potato/img/apple-touch-icon.png rel=apple-touch-icon><link href=https://fonts.googleapis.com rel=preconnect><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=EB+Garamond:ital,wght@0,400;0,500;0,600;0,700;0,800;1,400;1,500;1,600;1,700;1,800&display=swap" rel=stylesheet><link rel=stylesheet href=/psychic-octo-potato/vendor/bootstrap/css/bootstrap.min.min.dc0826ace23cb455591ae2937ea35fc16c94d03af6464987557ca7d7c17d9db4.css integrity="sha256-3AgmrOI8tFVZGuKTfqNfwWyU0Dr2RkmHVXyn18F9nbQ=" crossorigin=anonymous><link rel=stylesheet href=/psychic-octo-potato/vendor/bootstrap-icons/bootstrap-icons.min.479ee4eae0212420db028abf9a92a1db0a2b2f69c795756f790572add9f2694e.css integrity="sha256-R57k6uAhJCDbAoq/mpKh2worL2nHlXVveQVyrdnyaU4=" crossorigin=anonymous><link rel=stylesheet href=/psychic-octo-potato/vendor/aos/aos.min.36bc992fb225a9c3b1c37f25f59f136b2b8eaf29df68002045ed0987b3eabec5.css integrity="sha256-NryZL7IlqcOxw38l9Z8TayuOrynfaAAgRe0Jh7PqvsU=" crossorigin=anonymous><link rel=stylesheet href=/psychic-octo-potato/vendor/swiper/swiper-bundle.min.min.5983c13a687fefa51ed8c90899af9d232c7cf661ce4b8227d98b68044c7b43d5.css integrity="sha256-WYPBOmh/76Ue2MkIma+dIyx89mHOS4In2YtoBEx7Q9U=" crossorigin=anonymous><link rel=stylesheet href=/psychic-octo-potato/scss/main.min.93bcacb1e9f4733717e048ed3e85c9c0c0a42e8e81921cee5e45582d575b1e07.css></head><body class=single-page><header id=header class="header d-flex align-items-center sticky-top"><div class="container position-relative d-flex align-items-center justify-content-between"><a href=/ class="logo d-flex align-items-center me-auto me-xl-0"><h1>Home</h1></a><nav id=navmenu class=navmenu><ul><li><a href=/psychic-octo-potato/>Blog</a></li><li><a href=/psychic-octo-potato/resume/>Resume</a></li><li><a href=/psychic-octo-potato/search/>Search</a></li></ul></nav><div class=header-social-links><a href=https://x.com/SujithQ target=_blank class=twitter><i class="bi bi-twitter-x"></i></a>
<a href=https://www.facebook.com/sujith.quintelier target=_blank class=facebook><i class="bi bi-facebook"></i></a>
<a href=https://github.com/sujithq target=_blank class=github><i class="bi bi-github"></i></a>
<a href=https://www.linkedin.com/in/sujithquintelier/ target=_blank class=linkedin><i class="bi bi-linkedin"></i></a></div></div></header><main class=main><div class="container aos-init aos-animate" data-aos=fade-up data-aos-delay=100><div class=row><div class=col-lg><div class=page-title><div class="container d-lg-flex justify-content-between align-items-center"><h1 class="mb-2 mb-lg-0">ðŸš€ How to Retrieve Stale Branches Across All Repositories in a GitHub Organization</h1></div></div><div class=timeline-item><div class=timeline-content><div class=row><article class=article><div class=post-img><img src=/psychic-octo-potato/posts/2025-02-14-how-to-retrieve-stale-branches-github-organization//cover.jpg alt class=img-fluid></div><div class=meta-top><ul><li class="d-flex align-items-center"><a href=/psychic-octo-potato/resume/><img class="rounded-circle flex-shrink-0" height=20 width=20 alt=Avatar loading=lazy src="https://www.gravatar.com/avatar/a05c76c8e3ee75a331388cf94b006d18?d=mp&amp;s=20"></a></li><li class="d-flex align-items-center"><time datetime=2020-01-01>Feb 14, 2025</time></li></ul></div><div class=markdown-content><p>Keeping your GitHub repositories clean is crucial for maintainability. Over time, branches pile up, making it difficult to track whatâ€™s relevant. If youâ€™re managing multiple repositories in an organization, manually identifying stale branches can be a hassle.</p><p>Luckily, with the <strong>GitHub CLI (<code>gh</code>)</strong>, you can automate this process and generate a <strong>report of all non-main branches along with their last authors</strong>.</p><p>This guide walks you through a <strong>Bash script</strong> that:<br>âœ… Retrieves all repositories in an organization<br>âœ… Lists branches, excluding <code>main</code>, <code>master</code>, and <code>azure-master</code><br>âœ… Identifies the last commit author for each branch<br>âœ… Groups the results by author for better visibility</p><hr><h2 id=-prerequisites>ðŸ”§ Prerequisites</h2><p>Before running the script, make sure:</p><ul><li>You have <strong>GitHub CLI (<code>gh</code>)</strong> installed and authenticated (<code>gh auth login</code>).</li><li>You have <strong>appropriate permissions</strong> to list repositories and fetch branch details in your organization.</li><li>You&rsquo;re running a <strong>Unix-based system</strong> (Linux/macOS or WSL for Windows).</li></ul><hr><h2 id=-the-script>ðŸ“œ The Script</h2><p>Hereâ€™s the complete Bash script to <strong>scan all repositories</strong> in your GitHub organization and generate a <strong>stale branch report</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Set Variables</span>
</span></span><span class=line><span class=cl><span class=nv>org</span><span class=o>=</span><span class=s2>&#34;&lt;Replace with your GitHub Organization name&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>raw_output_file</span><span class=o>=</span><span class=s2>&#34;branches.txt&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>report_file</span><span class=o>=</span><span class=s2>&#34;report.txt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Clear previous output</span>
</span></span><span class=line><span class=cl>&gt; <span class=s2>&#34;</span><span class=nv>$raw_output_file</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Get the repositories as JSON and extract names</span>
</span></span><span class=line><span class=cl><span class=nv>repos</span><span class=o>=</span><span class=k>$(</span>gh repo list <span class=s2>&#34;</span><span class=nv>$org</span><span class=s2>&#34;</span> --json name --jq <span class=s1>&#39;.[].name&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Function to get branch author safely</span>
</span></span><span class=line><span class=cl>get_author<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>org</span><span class=o>=</span><span class=nv>$1</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>repo</span><span class=o>=</span><span class=nv>$2</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>branch</span><span class=o>=</span><span class=nv>$3</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> author
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Try fetching author name</span>
</span></span><span class=line><span class=cl>    <span class=nv>author</span><span class=o>=</span><span class=k>$(</span>gh api <span class=s2>&#34;/repos/</span><span class=nv>$org</span><span class=s2>/</span><span class=nv>$repo</span><span class=s2>/branches/</span><span class=nv>$branch</span><span class=s2>&#34;</span> --jq <span class=s1>&#39;.commit.commit.author.name&#39;</span> 2&gt;/dev/null<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># If author is empty, return &#34;Unknown&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> -z <span class=s2>&#34;</span><span class=nv>$author</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nv>author</span><span class=o>=</span><span class=s2>&#34;Unknown&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Write to output file</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;  - Author: </span><span class=nv>$author</span><span class=s2>&#34;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$raw_output_file</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Loop through each repository</span>
</span></span><span class=line><span class=cl><span class=k>for</span> repo in <span class=nv>$repos</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;- repo: </span><span class=nv>$repo</span><span class=s2>&#34;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$raw_output_file</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Get all branches in the repository</span>
</span></span><span class=line><span class=cl>    <span class=nv>branches</span><span class=o>=</span><span class=k>$(</span>gh api <span class=s2>&#34;/repos/</span><span class=nv>$org</span><span class=s2>/</span><span class=nv>$repo</span><span class=s2>/branches&#34;</span> --jq <span class=s1>&#39;.[].name&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Loop through each branch</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> branch in <span class=nv>$branches</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=c1># Skip master, azure-master, and main</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=nv>$branch</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;master&#34;</span> <span class=o>||</span> <span class=s2>&#34;</span><span class=nv>$branch</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;azure-master&#34;</span> <span class=o>||</span> <span class=s2>&#34;</span><span class=nv>$branch</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;main&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34; - Branch: </span><span class=nv>$branch</span><span class=s2>&#34;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$raw_output_file</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># Fetch branch author</span>
</span></span><span class=line><span class=cl>        get_author <span class=s2>&#34;</span><span class=nv>$org</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$repo</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$branch</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>done</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>declare</span> -A author_repos  <span class=c1># Declare an associative array</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Ensure the array is cleared before each run</span>
</span></span><span class=line><span class=cl><span class=nb>unset</span> author_repos
</span></span><span class=line><span class=cl><span class=nb>declare</span> -A author_repos
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Clear previous report</span>
</span></span><span class=line><span class=cl>&gt; <span class=s2>&#34;</span><span class=nv>$report_file</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Read and process output file</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=nv>IFS</span><span class=o>=</span> <span class=nb>read</span> -r line<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> <span class=nv>$line</span> <span class=o>==</span> <span class=s2>&#34;- repo: &#34;</span>* <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nv>repo</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$line</span><span class=s2>&#34;</span> <span class=p>|</span> awk <span class=s1>&#39;{print $3}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=o>[[</span> <span class=nv>$line</span> <span class=o>==</span> <span class=s2>&#34; - Branch: &#34;</span>* <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nv>branch</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$line</span><span class=s2>&#34;</span> <span class=p>|</span> awk <span class=s1>&#39;{print $3}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=o>[[</span> <span class=nv>$line</span> <span class=o>==</span> <span class=s2>&#34;  - Author: &#34;</span>* <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nv>author</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$line</span><span class=s2>&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/  - Author: //&#39;</span><span class=k>)</span>  <span class=c1># Extract author name</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Store branch under author</span>
</span></span><span class=line><span class=cl>        author_repos<span class=o>[</span><span class=s2>&#34;</span><span class=nv>$author</span><span class=s2>&#34;</span><span class=o>]</span>+<span class=o>=</span><span class=s1>$&#39;\n&#39;</span><span class=s2>&#34;- </span><span class=nv>$repo</span><span class=s2> -&gt; </span><span class=nv>$branch</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=k>done</span> &lt; <span class=s2>&#34;</span><span class=nv>$raw_output_file</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Print grouped results</span>
</span></span><span class=line><span class=cl><span class=k>for</span> author in <span class=s2>&#34;</span><span class=si>${</span><span class=p>!author_repos[@]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;Author: </span><span class=nv>$author</span><span class=s2>&#34;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$report_file</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>author_repos</span><span class=p>[</span><span class=nv>$author</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$report_file</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$report_file</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat <span class=s2>&#34;</span><span class=nv>$report_file</span><span class=s2>&#34;</span>
</span></span></code></pre></div><hr><h2 id=-example-output>ðŸ“Š Example Output</h2><p>Once executed, the script produces a <strong>report grouped by author</strong>, making it easy to find out <strong>who owns stale branches</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Author: Alice
</span></span><span class=line><span class=cl>- repo1 -&gt; feature/login-page
</span></span><span class=line><span class=cl>- repo2 -&gt; hotfix/payment-fix
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Author: Bob
</span></span><span class=line><span class=cl>- repo3 -&gt; refactor/api-updates
</span></span><span class=line><span class=cl>- repo1 -&gt; test/legacy-integration
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Author: Unknown
</span></span><span class=line><span class=cl>- repo4 -&gt; bugfix/session-timeout
</span></span></code></pre></div><hr><h2 id=-why-this-matters>ðŸ”¥ Why This Matters</h2><ol><li><strong>Easier Maintenance</strong> â€“ Identify branches that can be deleted or merged.</li><li><strong>Better Collaboration</strong> â€“ Reach out to authors to confirm branch status.</li><li><strong>Improved Performance</strong> â€“ Reducing unnecessary branches speeds up repository operations.</li></ol><p>You can extend this script further to:<br>âœ… Filter branches by <strong>last commit date</strong><br>âœ… Automatically <strong>delete stale branches</strong> (with <code>gh api -X DELETE</code>)<br>âœ… Generate a <strong>GitHub issue or PR</strong> listing stale branches</p><p>Would love to hear how you customize this for your workflow! ðŸš€</p></div><div class=meta-bottom><div class=tags-widget><div class=container-meta><i class="bi bi-stack"></i><ul class=cats><li><a href=/series/GitHub%20and%20DevOps>GitHub and DevOps</a></li></ul></div><div class=container-meta><i class="bi bi-folder"></i><ul class=cats><li><a href=/categories/Professional%20Experience>Professional Experience</a></li></ul></div><div class=container-meta><i class="bi bi-tags"></i><ul class=tags><li><a href=/tags/GitHub>GitHub</a></li><li><a href=/tags/GitHub%20CLI>GitHub CLI</a></li><li><a href=/tags/Automation>Automation</a></li><li><a href=/tags/Bash%20Scripting>Bash Scripting</a></li><li><a href=/tags/DevOps>DevOps</a></li><li><a href=/tags/Repository%20Management>Repository Management</a></li><li><a href=/tags/Stale%20Branches>Stale Branches</a></li><li><a href=/tags/Git>Git</a></li><li><a href=/tags/Scripting>Scripting</a></li><li><a href=/tags/GitHub%20API>GitHub API</a></li><li><a href=/tags/Branch%20Cleanup>Branch Cleanup</a></li><li><a href=/tags/GitHub%20Organization>GitHub Organization</a></li><li><a href=/tags/Security>Security</a></li><li><a href=/tags/Collaboration>Collaboration</a></li><li><a href=/tags/Productivity>Productivity</a></li></ul></div></div></div></article></div></div></div><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//sujithq.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></main><footer id=footer class="footer dark-background"><div class="container copyright text-center mt-4"><p>Â© <span>Copyright 2025-Present</span> <strong class="px-1 sitename">Sujith Quintelier</strong> <span>All Rights Reserved</span></p></div></footer><a href=# id=scroll-top class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a><div id=preloader></div><script src=/psychic-octo-potato/vendor/bootstrap/js/bootstrap.bundle.min.0a2d9f20f3d87493678691e0d9c114f7a05ba8c6da1e9668759b9a17192c8d62.js integrity="sha256-Ci2fIPPYdJNnhpHg2cEU96BbqMbaHpZodZuaFxksjWI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js></script><script>function aosInit(){AOS.init({duration:600,easing:"ease-in-out",once:!0,mirror:!1})}window.addEventListener("DOMContentLoaded",aosInit)</script><script src=/psychic-octo-potato/vendor/swiper/swiper-bundle.min.a9f1a126d8c86f35ecdfaf57d79e8d7ced4ad122cd0fec961937b209e1dc09d9.js integrity="sha256-qfGhJtjIbzXs369X156NfO1K0SLND+yWGTeyCeHcCdk=" crossorigin=anonymous></script><script src=/psychic-octo-potato/ts/main.f51f4656145ceb2ef15f082a7588110128f74f3f1c55c9b988e96b2054a44bf2.js integrity="sha256-9R9GVhRc6y7xXwgqdYgRASj3Tz8cVcm5iOlrIFSkS/I=" crossorigin=anonymous></script><script src=/psychic-octo-potato/js/main.7772214ebc716327d70367f18e2d26997c680d6180b16048d79e60da309fb255.js integrity="sha256-d3IhTrxxYyfXA2fxji0mmXxoDWGAsWBI155g2jCfslU=" crossorigin=anonymous></script></body></html>